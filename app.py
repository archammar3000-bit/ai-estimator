import streamlit as st
import google.generativeai as genai
import json

# ุฅุนุฏุงุฏ ุงูุตูุญุฉ ูุชุตููููุง
st.set_page_config(
    page_title="ุงูููุฏุฑ ุงูููุฏุณู ุงูุฐูู", 
    page_icon="๐๏ธ", 
    layout="wide", 
    initial_sidebar_state="collapsed"
)

# ูุญุงููุฉ ุฌูุจ ุงูููุชุงุญ ูู ุฃุณุฑุงุฑ ุงููุธุงู
try:
    api_key = st.secrets["GOOGLE_API_KEY"]
except:
    api_key = None

def get_ai_data(item, qty):
    # ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุงุญ
    if not api_key:
        return {"error": "ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุงุญ API. ุชุฃูุฏ ูู ุฅุถุงูุชู ูู ุฅุนุฏุงุฏุงุช Secrets ูู Streamlit."}
    
    try:
        # ุฅุนุฏุงุฏ ุงูุงุชุตุงู ุจุฌูุฌู ุจุงุณุชุฎุฏุงู ุงูููุฏูู ุงูุฌุฏูุฏ ุงูุณุฑูุน
        genai.configure(api_key=api_key)
        
        # ุงูุชุนุฏูู ุงููุงู ููุง: ุงุณุชุฎุฏุงู ุงูููุฏูู ุงูุฃุญุฏุซ
        model = genai.GenerativeModel('gemini-1.5-flash')
        
        # ุงูุฑุณุงูุฉ ุงูููุฌูุฉ ููุฐูุงุก ุงูุงุตุทูุงุนู
        prompt = f"""
        ุฃูุช ุฎุจูุฑ ุชุณุนูุฑ ูุชุฎุทูุท ููุฏุณู.
        ุงููููุฉ: ุชุญููู ุจูุฏ "{item}"ุ ุงููููุฉ ุงูุฅุฌูุงููุฉ: {qty}.
        
        ุงููุทููุจ: ุฅุฎุฑุงุฌ ุงูุจูุงูุงุช ุงูุชุงููุฉ ุจุตูุบุฉ JSON Strict ููุท (ุจุฏูู ุฃู ูุตูุต ุฎุงุฑุฌ ุงูู JSON):
        {{
            "unit": "ูุญุฏุฉ ุงูููุงุณ ุงูููุฏุณูุฉ ุงูููุงุณุจุฉ",
            "rate": "ูุนุฏู ุงูุฅูุชุงุฌ ุงููููู ุงูุชูุฑูุจู ูุทุงูู ูุงุญุฏ (ุฑูู ููุท)",
            "days": "ุนุฏุฏ ุงูุฃูุงู ุงููุชููุนุฉ ููุฅูุฌุงุฒ (ุฑูู ููุท)",
            "crew": "ุชูุงุตูู ุงูุนูุงูุฉ ุงููุทููุจุฉ ููููุงู (ูุซุงู: 2 ุจูุงุกุ 1 ูุณุงุนุฏ)",
            "equip": "ุงููุนุฏุงุช ูุงูุฃุฏูุงุช ุงููุงุฒูุฉ",
            "notes": "ูุตูุญุฉ ูููุฉ ูุฎุชุตุฑุฉ ููุชูููุฐ ุฃู ุงูุงุณุชูุงู"
        }}
        """
        
        # ุฅุฑุณุงู ุงูุทูุจ
        response = model.generate_content(prompt)
        
        # ุชูุธูู ุงููุต ุงููุณุชูู ูุถูุงู ุฎููู ูู ุดูุงุฆุจ ุงูููุฏ
        clean_text = response.text.replace('```json', '').replace('```', '').strip()
        
        # ุชุญููู ุงููุต ุฅูู ูุงููุณ ุจูุงูุงุช
        return json.loads(clean_text)

    except Exception as e:
        # ุฅุฑุฌุงุน ุชูุงุตูู ุงูุฎุทุฃ ูู ุญุงู ุญุฏูุซู
        return {"error": str(e)}

# --- ูุงุฌูุฉ ุงูุชุทุจูู (UI) ---
st.markdown("<h1 style='text-align: center; color: #1E88E5;'>๐๏ธ ุงููุฑุฌุน ุงูููุฏุณู ุงูุดุงูู (AI Powered)</h1>", unsafe_
